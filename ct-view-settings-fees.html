<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-input/paper-input-behavior.html">


<link rel="import" href="../iron-form/iron-form.html">
<link rel="import" href="../iron-icon/iron-icon.html">

<link rel="import" href="../ct-currency-behaviour/ct-currency-behaviour.html">
<link rel="import" href="../ct-editable-switcher/ct-editable-switcher.html">
<link rel="import" href="../ct-category-settings/ct-category-settings.html">
<link rel="import" href="../shared-styles/ct-application-theme.html">
<link rel="import" href="../ct-setting-api/ct-setting-api.html">

<!--
`ct-view-settings-fees`
Element to view fees in settings on the Centular platform

@demo demo/index.html
-->

<dom-module id="ct-view-settings-fees">

  <template>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <style is="global-styles">
      :host {
        display: block;
        --paper-input-container:{
          padding: 0 !important;
        };
        paper-input-container:{
          padding: 0 !important;
        };
      }
      .vertical-middle {
        vertical-align: middle;
        display: table-cell;
      }
      .vertical-middle-container {
        height: 62px;
        display: table;
        float: none;
        table-layout: fixed;
      }

      .row-striped:nth-of-type(odd){
        background-color: #efefef;
      }

      .row-striped:nth-of-type(even){
        background-color: #ffffff;
      }
      .fees-container .row {
        /*display: flex;*/
        align-items: center;
      }
      paper-input-container.input-element {
        padding: 0 !important;
      }
    </style>


    <div class="container-fluid fees-container">
      <div class="row">
        <div class="col-xs-12">
          <ct-setting-api></ct-setting-api>
          <ct-category-settings category="admin-fees" category-display-name="Admin Fees (incl VAT)"></ct-category-settings>
          <ct-category-settings category="merchant-fees" category-display-name="Merchant Fees (incl VAT)"></ct-category-settings>
        </div>
      </div>
    </div>
  </template>

  <script>
      Polymer({

          is: 'ct-view-settings-fees',
          behaviors: [CurrencyBehaviours.CurrencyFormatBehaviour],

          properties: {
              feesData : Object,
              _isStateEdit : {
                  type: Boolean,
                  value: function() {
                      return false;
                  },
              },


          },

          _computeReadOnly : function(status){
              return (!status);
          },

          _computeButtonText: function(isEdit){
              return (isEdit) ? 'Save Fees' : 'Edit Fees';
          },

          _computeBtnStyle : function(isEdit){
              return (isEdit) ? "btn-primary" : "btn-default";
          },

          _toggleStatus : function(){
              this._isStateEdit = !this._isStateEdit;
          },

          _editBtnHandler : function(){
              var form = this.$$('form');
              if(this._isStateEdit){
                  if(form.validate()){
                      form.submit();
                  }
              } else {
                  this._toggleStatus();
              }
          },
          _formHandler : function(e){

              var form = this.$$('form').serialize(),
                  params = {};

              e.preventDefault();
          },
          _getList : function(){
              this.$.settingApi.getSettings()
                  .then(function (request) {
                  this._feeOptionList = request.response.results;
                          }.bind(this))

                  .catch(this.fire.bind(this, 'toast', {message: 'Failed to load fee options', type: 'danger'}))
                  .finally(this.set.bind(this, 'refreshing', false));
          },

          _updateSetting : function () {
            this.$.settingApi.updateSetting()
            .then(this.fire.bind(this, 'toast', {message: 'Successfully updated fees', type: 'success'}))
                  .catch(this.fire.bind(this, 'toast', {message: 'Error updating fees.', type: 'danger'}))
                  .finally(function(){
                      this.refreshing = false;
                  });
          },

      });
  </script>
</dom-module>
